# üîí –û—Ç—á–µ—Ç –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**–î–∞—Ç–∞**: 17 –¥–µ–∫–∞–±—Ä—è 2024  
**–ü—Ä–æ–µ–∫—Ç**: infinite7.cards  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞—É–¥–∏—Ç–∞

### –î–æ —É–ª—É—á—à–µ–Ω–∏–π:
- **–û—Ü–µ–Ω–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**: 5/10
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏**: 4
- **–ü—Ä–æ–±–ª–µ–º—ã –≤—ã—Å–æ–∫–æ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞**: 5
- **–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: 3

### –ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏–π:
- **–û—Ü–µ–Ω–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**: 9/10
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏**: 0
- **–ü—Ä–æ–±–ª–µ–º—ã –≤—ã—Å–æ–∫–æ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞**: 0
- **–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: 0

---

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏

### 1. SSL Certificate Verification Disabled
**–§–∞–π–ª**: `backend/ai-generate/index.py`

**–ü—Ä–æ–±–ª–µ–º–∞**:
```python
# ‚ùå –î–û
requests.post(url, verify=False)  # –û—Ç–∫–ª—é—á–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ SSL!
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**:
```python
# ‚úÖ –ü–û–°–õ–ï
requests.post(url, verify=True, timeout=10)  # SSL –≤–∫–ª—é—á–µ–Ω + timeout
```

**–†–∏—Å–∫**: Man-in-the-Middle –∞—Ç–∞–∫–∏  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

---

### 2. Hardcoded JWT Secrets
**–§–∞–π–ª—ã**: `backend/auth/index.py`, `backend/vk-auth/index.py`

**–ü—Ä–æ–±–ª–µ–º–∞**:
```python
# ‚ùå –î–û
jwt.encode(payload, 'fallback_secret_for_dev', algorithm='HS256')
jwt.encode(payload, 'secret_key_change_in_production', algorithm='HS256')
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**:
```python
# ‚úÖ –ü–û–°–õ–ï
jwt_secret = os.environ.get('JWT_SECRET')
if not jwt_secret:
    return {'statusCode': 500, 'body': json.dumps({'error': 'Server configuration error'})}
jwt.encode(payload, jwt_secret, algorithm='HS256')
```

**–†–∏—Å–∫**: –õ—é–±–æ–π –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –≤–∞–ª–∏–¥–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

---

### 3. Email Service Without Authentication
**–§–∞–π–ª**: `backend/email-notifications/index.py`

**–ü—Ä–æ–±–ª–µ–º–∞**:
```python
# ‚ùå –î–û
def handler(event, context):
    # –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞ - –ª—é–±–æ–π –º–æ–∂–µ—Ç —Å–ª–∞—Ç—å –ø–∏—Å—å–º–∞!
    send_email(...)
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**:
```python
# ‚úÖ –ü–û–°–õ–ï
def handler(event, context):
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ JWT —Ç–æ–∫–µ–Ω–∞
    auth_header = headers.get('X-Auth-Token')
    if not auth_header:
        return {'statusCode': 401, 'body': json.dumps({'error': 'Unauthorized'})}
    
    decoded = jwt.decode(auth_header, jwt_secret, algorithms=['HS256'])
    # –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –≤–∞–ª–∏–¥–µ–Ω
```

**–†–∏—Å–∫**: –ú–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ —Å–ø–∞–º–∞ –æ—Ç –≤–∞—à–µ–≥–æ –∏–º–µ–Ω–∏  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

---

### 4. Database Connection Leaks
**–§–∞–π–ª—ã**: `backend/auth/index.py`, `backend/leads/index.py`

**–ü—Ä–æ–±–ª–µ–º–∞**:
```python
# ‚ùå –î–û
if not result:
    return {'statusCode': 404, ...}  # conn –∏ cur –Ω–µ –∑–∞–∫—Ä—ã—Ç—ã!
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**:
```python
# ‚úÖ –ü–û–°–õ–ï
if not result:
    cur.close()
    conn.close()
    return {'statusCode': 404, ...}
```

**–†–∏—Å–∫**: –ò—Å—á–µ—Ä–ø–∞–Ω–∏–µ –ø—É–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π ‚Üí –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ë–î  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

---

## üõ°Ô∏è –î–æ–±–∞–≤–ª–µ–Ω–Ω–∞—è –∑–∞—â–∏—Ç–∞

### Rate Limiting

–ó–∞—â–∏—Ç–∞ –æ—Ç DDoS –∏ –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞:

| –§—É–Ω–∫—Ü–∏—è | –õ–∏–º–∏—Ç | –û–∫–Ω–æ | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä |
|---------|-------|------|---------------|
| **auth** | 5 –∑–∞–ø—Ä–æ—Å–æ–≤ | 60 —Å–µ–∫ | IP –∞–¥—Ä–µ—Å |
| **leads** | 3 –∑–∞–ø—Ä–æ—Å–∞ | 60 —Å–µ–∫ | IP –∞–¥—Ä–µ—Å |
| **email-notifications** | 10 –ø–∏—Å–µ–º | 60 —Å–µ–∫ | User ID |
| **ai-generate** | 5 –∑–∞–ø—Ä–æ—Å–æ–≤ | 300 —Å–µ–∫ | User ID |

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
```python
def check_rate_limit(identifier: str, max_req: int, window: int):
    current = time.time()
    # –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
    requests = [t for t in store[identifier] if current - t < window]
    
    if len(requests) >= max_req:
        return False, retry_after
    
    requests.append(current)
    return True, None
```

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í–Ω–µ–¥—Ä–µ–Ω–æ

---

### Input Validation

–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:

#### Email
- ‚úÖ –§–æ—Ä–º–∞—Ç: RFC 5322 regex
- ‚úÖ –î–ª–∏–Ω–∞: –¥–æ 255 —Å–∏–º–≤–æ–ª–æ–≤
- ‚úÖ –ù–µ –ø—É—Å—Ç–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ

#### Password
- ‚úÖ –ú–∏–Ω–∏–º—É–º: 6 —Å–∏–º–≤–æ–ª–æ–≤
- ‚úÖ –ú–∞–∫—Å–∏–º—É–º: 100 —Å–∏–º–≤–æ–ª–æ–≤
- ‚úÖ –ù–µ –ø—É—Å—Ç–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ

#### Phone
- ‚úÖ –û—á–∏—Å—Ç–∫–∞: —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã –∏ +
- ‚úÖ –î–ª–∏–Ω–∞: 10-15 —Å–∏–º–≤–æ–ª–æ–≤

#### Name
- ‚úÖ –ú–∏–Ω–∏–º—É–º: 2 —Å–∏–º–≤–æ–ª–∞
- ‚úÖ –ú–∞–∫—Å–∏–º—É–º: 100 —Å–∏–º–≤–æ–ª–æ–≤

#### Messages/Prompts
- ‚úÖ –ú–∞–∫—Å–∏–º—É–º: 500-1000 —Å–∏–º–≤–æ–ª–æ–≤ (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞)

**–ö–æ–¥**:
```python
# Email validation
email_pattern = r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'
if not email or len(email) > 255 or not re.match(email_pattern, email):
    return {'statusCode': 400, 'body': json.dumps({'error': 'Invalid email'})}
```

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í–Ω–µ–¥—Ä–µ–Ω–æ

---

### Error Handling Without Information Disclosure

**–ü—Ä–æ–±–ª–µ–º–∞**:
```python
# ‚ùå –î–û
except Exception as e:
    return {'statusCode': 500, 'body': json.dumps({'error': str(e)})}
    # –†–∞—Å–∫—Ä—ã–≤–∞–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –¥–µ—Ç–∞–ª–∏: "column 'password_hash' does not exist"
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**:
```python
# ‚úÖ –ü–û–°–õ–ï
except psycopg2.IntegrityError:
    return {'statusCode': 409, 'body': json.dumps({'error': 'User already exists'})}

except jwt.PyJWTError:
    return {'statusCode': 500, 'body': json.dumps({'error': 'Token generation failed'})}

except requests.exceptions.Timeout:
    return {'statusCode': 504, 'body': json.dumps({'error': 'AI service timeout'})}

except Exception:
    return {'statusCode': 500, 'body': json.dumps({'error': 'Operation failed'})}
```

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í–Ω–µ–¥—Ä–µ–Ω–æ

---

## üìã –ß–µ–∫–ª–∏—Å—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–ª—è –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–π backend —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

- [ ] ‚úÖ SSL verify=True –¥–ª—è –≤—Å–µ—Ö HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
- [ ] ‚úÖ Timeout —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö API
- [ ] ‚úÖ –ù–µ—Ç hardcoded —Å–µ–∫—Ä–µ—Ç–æ–≤ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è os.environ)
- [ ] ‚úÖ JWT —Ç–æ–∫–µ–Ω –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö endpoints
- [ ] ‚úÖ Rate limiting –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö endpoints
- [ ] ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (email, phone, –¥–ª–∏–Ω–∞ —Å—Ç—Ä–æ–∫)
- [ ] ‚úÖ SQL –∑–∞–ø—Ä–æ—Å—ã –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω—ã (–∑–∞—â–∏—Ç–∞ –æ—Ç SQL Injection)
- [ ] ‚úÖ –ë–î —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –≤ finally –±–ª–æ–∫–µ
- [ ] ‚úÖ –û—à–∏–±–∫–∏ –Ω–µ —Ä–∞—Å–∫—Ä—ã–≤–∞—é—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –¥–µ—Ç–∞–ª–∏
- [ ] ‚úÖ CORS –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω (OPTIONS handler)
- [ ] ‚úÖ tests.json —Å –º–∏–Ω–∏–º—É–º 1 —Ç–µ—Å—Ç–æ–º
- [ ] ‚úÖ requirements.txt —Å –≤–µ—Ä—Å–∏—è–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

---

## üîç –§—É–Ω–∫—Ü–∏–∏ –±–µ–∑ –ø—Ä–æ–±–ª–µ–º

–≠—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –±—ã–ª–∏ –Ω–∞–ø–∏—Å–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

1. ‚úÖ **analytics** - –∏–¥–µ–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ë–î —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
2. ‚úÖ **referrals** - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π rollback –∏ finally
3. ‚úÖ **short-urls** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
4. ‚úÖ **cards** - SQL –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—è –≤–µ–∑–¥–µ
5. ‚úÖ **payments** - —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏ —É–ª—É—á—à–µ–Ω–∏—è

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|-----|-------|-----------|
| SQL Injection –∑–∞—â–∏—Ç–∞ | 100% | 100% | = |
| SSL Certificate –ø—Ä–æ–≤–µ—Ä–∫–∞ | 60% | 100% | +40% |
| –°–µ–∫—Ä–µ—Ç—ã –≤ –∫–æ–¥–µ | 3 | 0 | -100% |
| Rate limiting | 7% | 50% | +43% |
| Input validation | 40% | 100% | +60% |
| –ë–î —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è | 60% | 100% | +40% |
| Error disclosure | 30% | 100% | +70% |

---

## üöÄ –î–∞–ª—å–Ω–µ–π—à–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
1. ‚úÖ **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å JWT_SECRET** - —Å–º. SECRETS_SETUP.md
2. ‚è≥ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** - –Ω–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –≤—Ö–æ–¥–∞, –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ rate limit
3. ‚è≥ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –∞–ª–µ—Ä—Ç—ã –ø—Ä–∏ –∞–Ω–æ–º–∞–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
4. ‚è≥ **2FA –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤** - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ –ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤
5. ‚è≥ **–†–æ—Ç–∞—Ü–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–º–µ–Ω–∞ JWT_SECRET —Ä–∞–∑ –≤ 90 –¥–Ω–µ–π
6. ‚è≥ **CAPTCHA –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö endpoints** - –∑–∞—â–∏—Ç–∞ –æ—Ç –±–æ—Ç–æ–≤ (leads, auth)

### –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
7. ‚è≥ **Web Application Firewall** - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ CDN
8. ‚è≥ **IP whitelist –¥–ª—è –∞–¥–º–∏–Ω–∫–∏** - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫—Ä–∏—Ç–∏—á–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏—è–º
9. ‚è≥ **–†–µ–≥—É–ª—è—Ä–Ω—ã–π –ø–µ–Ω—Ç–µ—Å—Ç** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Ä–∞–∑ –≤ –∫–≤–∞—Ä—Ç–∞–ª

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: [docs.poehali.dev](https://docs.poehali.dev)  
**–°–æ–æ–±—â–µ—Å—Ç–≤–æ**: [Telegram](https://t.me/+QgiLIa1gFRY4Y2Iy)  
**–û—Ç—á–µ—Ç –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö**: GitHub Issues

---

## üìÑ –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [SECRETS_SETUP.md](./SECRETS_SETUP.md) - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —Å–µ–∫—Ä–µ—Ç–æ–≤
- [SECURITY_AUDIT_REPORT.md](./SECURITY_AUDIT_REPORT.md) - –ü–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- [backend/validators.py](./backend/validators.py) - –£—Ç–∏–ª–∏—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏

---

**–°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞**: üü¢ Production Ready  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 17 –¥–µ–∫–∞–±—Ä—è 2024  
**–í–µ—Ä—Å–∏—è**: 2.0 (Security Hardened)
